import i18n from 'i18next';
import {initReactI18next} from 'react-i18next';

const loadInitialLanguage = () => {
    try {
        const raw = localStorage.getItem('preferences');
        if (!raw) return 'it';
        const parsed = JSON.parse(raw) as { language?: string };
        return parsed.language === 'en' || parsed.language === 'it' ? parsed.language : 'it';
    } catch {
        return 'it';
    }
};

const resources = {
    it: {
        translation: {
            app: {
                name: 'NexaBudget'
            },
            common: {
                save: 'Salva',
                cancel: 'Annulla',
                delete: 'Elimina',
                edit: 'Modifica',
                add: 'Aggiungi',
                update: 'Aggiorna',
                close: 'Chiudi',
                confirm: 'Conferma',
                yes: 'Si',
                no: 'No',
                logout: 'Logout',
                menu: 'Menu',
                total: 'Totale',
                actions: 'Azioni'
            },
            nav: {
                dashboard: 'Dashboard',
                transactions: 'Transazioni',
                allTransactions: 'Tutte le Transazioni',
                crypto: 'Asset Crypto',
                settings: 'Impostazioni',
                accounts: 'Conti'
            },
            auth: {
                loginTitle: 'Login',
                signIn: 'Accedi',
                signUp: 'Registrati',
                username: 'Username',
                password: 'Password',
                email: 'Email',
                invalidCredentials: 'Credenziali non valide. Riprova.',
                registrationError: 'Errore di registrazione. Utente gia esistente.',
                usernameRequired: 'Inserisci lo username',
                passwordRequired: 'Inserisci la password',
                emailRequired: 'Inserisci una email valida',
                noAccount: 'Non hai un account?',
                haveAccount: 'Hai gia un account?',
                signUpNow: 'Registrati ora!',
                signInNow: 'Accedi',
                loginButton: 'Accedi',
                registerButton: 'Registrati'
            },
            accounts: {
                newAccount: 'Nuovo Conto',
                editAccount: 'Modifica Conto',
                accountName: 'Nome Conto',
                accountNamePlaceholder: 'Es. Conto Principale',
                accountType: 'Tipo di Conto',
                accountTypePlaceholder: 'Seleziona un tipo',
                accountTypeChecking: 'Conto Corrente',
                accountTypeSavings: 'Risparmio',
                accountTypeInvestment: 'Investimento',
                accountTypeCash: 'Contanti',
                startingBalance: 'Saldo Iniziale',
                startingBalanceRequired: 'Inserisci il saldo iniziale',
                currency: 'Valuta',
                currencyRequired: 'Inserisci la valuta',
                saveAccount: 'Salva Conto',
                updatedSuccess: 'Conto aggiornato con successo',
                createdSuccess: 'Conto creato con successo',
                saveError: 'Errore durante il salvataggio del conto',
                deletedSuccess: 'Conto eliminato con successo',
                deleteError: "Errore durante l'eliminazione del conto",
                deleteTitle: 'Elimina Conto',
                deleteConfirm: 'Sei sicuro di voler eliminare il conto "{{name}}"?',
                deleteConfirmWarning: 'Questa azione e irreversibile e cancella anche tutte le transazioni associate.',
                totalBalance: 'Saldo Totale'
            },
            transfers: {
                newTransfer: 'Nuovo Trasferimento',
                sourceAccount: 'Conto di Origine',
                sourceAccountRequired: 'Seleziona il conto di origine',
                sourceAccountPlaceholder: 'Da quale conto?',
                destinationAccount: 'Conto di Destinazione',
                destinationAccountRequired: 'Seleziona il conto di destinazione',
                destinationAccountPlaceholder: 'A quale conto?',
                destinationAccountDifferent: 'Il conto di destinazione deve essere diverso da quello di origine.',
                amount: 'Importo',
                amountRequired: "Inserisci l'importo",
                transferDate: 'Data del Trasferimento',
                transferDateRequired: 'Seleziona la data',
                description: 'Descrizione',
                descriptionRequired: 'Inserisci una descrizione',
                descriptionPlaceholder: 'Es. Giroconto',
                notes: 'Note',
                notesPlaceholder: 'Note aggiuntive (opzionale)',
                executeTransfer: 'Esegui Trasferimento',
                createdSuccess: 'Trasferimento creato con successo',
                createError: 'Errore durante la creazione del trasferimento'
            },
            gocardless: {
                connectTitle: 'Collega "{{name}}" a GoCardless',
                selectCountry: 'Seleziona Nazione',
                selectBank: 'Seleziona Banca',
                selectYourCountry: 'Seleziona la tua nazione',
                selectYourBank: 'Seleziona la tua banca',
                selectCountryPlaceholder: 'Seleziona una nazione',
                selectBankPlaceholder: 'Seleziona una banca',
                linkBank: 'Collega Banca',
                loadBanksError: 'Errore nel caricamento delle banche',
                linkError: 'Errore durante la generazione del link di collegamento',
                noAccountsToSync: 'Nessun conto da sincronizzare',
                syncSuccessAll: 'Sincronizzati con successo {{count}} conti',
                syncErrorAll: 'Errore nella sincronizzazione di tutti i {{count}} conti',
                syncPartial: 'Sincronizzati {{successCount}} conti, {{failureCount}} con errori',
                syncError: 'Errore durante la sincronizzazione dei conti',
                syncAllTitle: 'Sincronizza tutti i conti correnti'
            },
            gocardlessCallback: {
                invalidAccountId: 'ID conto non valido',
                noAccounts: 'Nessun conto bancario disponibile per la sincronizzazione',
                loadError: 'Errore durante il caricamento dei conti bancari',
                selectAccountAndBalance: 'Seleziona un conto e inserisci il bilancio corrente',
                linkSuccess: 'Conto bancario collegato con successo!',
                syncStartedTitle: 'Sincronizzazione Avviata',
                syncStartedDescription: 'Le transazioni verranno importate nei prossimi minuti.',
                syncErrorTitle: 'Errore di Sincronizzazione',
                syncErrorDescription: 'Si e verificato un errore durante la sincronizzazione delle transazioni. Riprova piu tardi.',
                loadingLinking: 'Collegamento e importazione transazioni in corso...',
                loadingAccounts: 'Caricamento conti bancari...',
                errorTitle: 'Errore',
                backToTransactions: 'Torna alle Transazioni',
                selectAccountTitle: 'Seleziona il Conto da Sincronizzare',
                selectAccountMessage: 'Seleziona un conto bancario',
                selectAccountDescription: 'Scegli quale conto bancario vuoi collegare e inserisci il bilancio corrente per allineare correttamente le transazioni.',
                bankUnknown: 'Banca Sconosciuta',
                accountNameLabel: 'Nome',
                currentBalanceLabel: 'Bilancio Corrente',
                currentBalanceHelp: 'Inserisci il bilancio attuale del conto bancario per allineare correttamente le transazioni',
                currentBalancePlaceholder: 'Es: 1000.00',
                confirmSelection: 'Conferma Selezione'
            },
            dashboard: {
                title: 'Dashboard',
                empty: 'Nessuna transazione trovata per il periodo selezionato.',
                netBalance: 'Saldo Netto',
                totalIncome: 'Entrate Totali',
                totalExpenses: 'Uscite Totali',
                vsPeriod: 'vs {{period}}',
                cryptoPortfolio: 'Portafoglio Crypto',
                incomeByCategory: 'Entrate per Categoria',
                expensesByCategory: 'Uscite per Categoria',
                monthlyTrend: 'Andamento Mensile (Entrate/Uscite)',
                netBalanceTrend: 'Andamento Saldo Netto Mensile'
            },
            charts: {
                noData: 'Nessun dato disponibile'
            },
            transactions: {
                titleAll: 'Tutte le Transazioni',
                titleAccount: 'Transazioni per {{account}}',
                data: 'Data',
                description: 'Descrizione',
                account: 'Conto',
                category: 'Categoria',
                amount: 'Importo',
                type: 'Tipo',
                typeIn: 'Entrata',
                typeOut: 'Uscita',
                actions: 'Azioni',
                newTransaction: 'Nuova Transazione',
                editTransaction: 'Modifica Transazione',
                newTransfer: 'Nuovo Trasferimento',
                syncGoCardless: 'Sync GoCardless',
                searchPlaceholder: 'Cerca per descrizione, conto, categoria',
                filterType: 'Filtra per tipo',
                fromDate: 'Da',
                toDate: 'A',
                sortBy: 'Ordina per',
                sortOrder: 'Ordine',
                sortAsc: 'Crescente',
                sortDesc: 'Decrescente',
                selectAccount: 'Seleziona un conto',
                selectCategory: 'Seleziona una categoria',
                selectType: 'Entrata o Uscita',
                note: 'Note',
                save: 'Salva',
                linkTransfer: 'Collega a Trasferimento',
                linkTransferSave: 'Salva Collegamento',
                linkTransferSource: 'Transazione di Origine',
                linkTransferSelectAccount: 'Seleziona Conto di Destinazione',
                linkTransferSelectTransaction: 'Seleziona la transazione da collegare',
                linkTransferNoCompatible: 'Nessuna transazione compatibile trovata nel periodo di +/-3 giorni con lo stesso importo e tipo opposto.',
                linkTransferLoadError: 'Errore nel recupero delle transazioni di destinazione.',
                linkTransferSuccess: 'Transazioni collegate con successo!',
                linkTransferError: 'Errore durante il collegamento delle transazioni.',
                balanceModalTitle: 'Inserisci Bilancio Corrente',
                balanceCurrent: 'Bilancio Corrente',
                balanceCurrentInfo: 'Inserisci il bilancio attuale del conto bancario per allineare correttamente le transazioni dopo la sincronizzazione. Se vuoi solo sincronizzare le transazioni senza modificare il bilancio corrente, lascia vuoto questo campo.',
                balanceCurrentPlaceholder: 'Es: 1000.00',
                syncStartedTitle: 'Sincronizzazione Avviata',
                syncStartedDescription: 'Le transazioni verranno aggiornate in background nei prossimi minuti.',
                syncErrorTitle: 'Errore di Sincronizzazione',
                syncErrorDescription: 'Si e verificato un errore durante la sincronizzazione delle transazioni. Riprova piu tardi.',
                invalidAccountId: 'ID conto non valido',
                currentBalanceLabel: 'Saldo corrente: {{balance}}',
                currentBalanceFallback: 'N/D',
                accountLabelFallback: 'Conto'
            },
            crypto: {
                title: 'Portafoglio Crypto',
                connectBinance: 'Collega Binance',
                addHolding: 'Aggiungi Holding',
                syncBinance: 'Sincronizza Binance',
                syncStarted: 'Sincronizzazione Binance avviata',
                loadError: 'Impossibile caricare i dati del portafoglio.',
                syncError: 'Impossibile sincronizzare con Binance.',
                holdingDeleted: 'Holding eliminata con successo',
                holdingDeleteError: 'Impossibile eliminare la holding.'
            },
            portfolio: {
                totalValue: 'Valore Totale Portafoglio',
                yourAssets: 'I tuoi asset',
                asset: 'Asset',
                amount: 'Quantita',
                price: 'Prezzo',
                value: 'Valore',
                source: 'Fonte',
                actions: 'Azioni',
                deleteHolding: 'Elimina holding',
                deleteHoldingConfirm: 'Sei sicuro di voler eliminare questa holding?'
            },
            binanceKeys: {
                title: 'Collega account Binance',
                apiKey: 'API Key',
                apiSecret: 'API Secret',
                apiKeyRequired: 'Inserisci la tua Binance API Key',
                apiSecretRequired: 'Inserisci la tua Binance API Secret',
                saveKeys: 'Salva Chiavi',
                cancel: 'Annulla',
                saveSuccess: 'Chiavi Binance salvate con successo',
                saveError: 'Impossibile salvare le chiavi Binance. Riprova.'
            },
            manualHolding: {
                titleAdd: 'Aggiungi Holding Manuale',
                titleEdit: 'Modifica Holding Manuale',
                symbol: 'Simbolo Crypto',
                symbolRequired: 'Inserisci il simbolo crypto (es. BTC)',
                amount: 'Quantita',
                amountRequired: 'Inserisci la quantita',
                add: 'Aggiungi Holding',
                update: 'Aggiorna Holding',
                cancel: 'Annulla',
                saveError: 'Impossibile salvare la holding. Riprova.',
                addedSuccess: 'Holding aggiunta con successo',
                updatedSuccess: 'Holding aggiornata con successo'
            },
            pwa: {
                title: 'Installa NexaBudget',
                description: "Aggiungi l'app alla tua schermata Home per un accesso rapido",
                install: 'Installa'
            },
            settings: {
                title: 'Impostazioni',
                appearanceTitle: 'Aspetto',
                theme: 'Tema',
                themeLight: 'Chiaro',
                themeDark: 'Scuro',
                languageTitle: 'Lingua',
                language: 'Lingua applicazione',
                languageIt: 'Italiano',
                languageEn: 'Inglese',
                serverTitle: 'Impostazioni server',
                serverPlaceholder: 'Questa sezione e solo un placeholder per ora.',
                serverBaseUrl: 'Base URL',
                serverTimeout: 'Timeout (ms)',
                serverTimeoutPlaceholder: 'Es: 15000'
            }
        }
    },
    en: {
        translation: {
            app: {
                name: 'NexaBudget'
            },
            common: {
                save: 'Save',
                cancel: 'Cancel',
                delete: 'Delete',
                edit: 'Edit',
                add: 'Add',
                update: 'Update',
                close: 'Close',
                confirm: 'Confirm',
                yes: 'Yes',
                no: 'No',
                logout: 'Logout',
                menu: 'Menu',
                total: 'Total',
                actions: 'Actions'
            },
            nav: {
                dashboard: 'Dashboard',
                transactions: 'Transactions',
                allTransactions: 'All Transactions',
                crypto: 'Crypto Assets',
                settings: 'Settings',
                accounts: 'Accounts'
            },
            auth: {
                loginTitle: 'Login',
                signIn: 'Sign In',
                signUp: 'Sign Up',
                username: 'Username',
                password: 'Password',
                email: 'Email',
                invalidCredentials: 'Invalid credentials. Please try again.',
                registrationError: 'Registration error. User may already exist.',
                usernameRequired: 'Please enter your username!',
                passwordRequired: 'Please enter your password!',
                emailRequired: 'Please enter your email!',
                noAccount: "Don't have an account?",
                haveAccount: 'Already have an account?',
                signUpNow: 'Sign up now!',
                signInNow: 'Sign In',
                loginButton: 'Sign In',
                registerButton: 'Sign Up'
            },
            accounts: {
                newAccount: 'New Account',
                editAccount: 'Edit Account',
                accountName: 'Account Name',
                accountNamePlaceholder: 'e.g. Main Account',
                accountType: 'Account Type',
                accountTypePlaceholder: 'Select a type',
                accountTypeChecking: 'Checking',
                accountTypeSavings: 'Savings',
                accountTypeInvestment: 'Investment',
                accountTypeCash: 'Cash',
                startingBalance: 'Starting Balance',
                startingBalanceRequired: 'Please enter the starting balance',
                currency: 'Currency',
                currencyRequired: 'Please enter the currency',
                saveAccount: 'Save Account',
                updatedSuccess: 'Account updated successfully',
                createdSuccess: 'Account created successfully',
                saveError: 'Error while saving the account',
                deletedSuccess: 'Account deleted successfully',
                deleteError: 'Error while deleting the account',
                deleteTitle: 'Delete Account',
                deleteConfirm: 'Are you sure you want to delete the account "{{name}}"?',
                deleteConfirmWarning: 'This action is irreversible and will also delete all related transactions.',
                totalBalance: 'Total Balance'
            },
            transfers: {
                newTransfer: 'New Transfer',
                sourceAccount: 'Source Account',
                sourceAccountRequired: 'Select the source account',
                sourceAccountPlaceholder: 'From which account?',
                destinationAccount: 'Destination Account',
                destinationAccountRequired: 'Select the destination account',
                destinationAccountPlaceholder: 'To which account?',
                destinationAccountDifferent: 'The destination account must be different from the source account.',
                amount: 'Amount',
                amountRequired: 'Please enter the amount',
                transferDate: 'Transfer Date',
                transferDateRequired: 'Select the date',
                description: 'Description',
                descriptionRequired: 'Please enter a description',
                descriptionPlaceholder: 'e.g. Transfer',
                notes: 'Notes',
                notesPlaceholder: 'Additional notes (optional)',
                executeTransfer: 'Execute Transfer',
                createdSuccess: 'Transfer created successfully',
                createError: 'Error while creating the transfer'
            },
            gocardless: {
                connectTitle: 'Link "{{name}}" to GoCardless',
                selectCountry: 'Select Country',
                selectBank: 'Select Bank',
                selectYourCountry: 'Select your country',
                selectYourBank: 'Select your bank',
                selectCountryPlaceholder: 'Select a country',
                selectBankPlaceholder: 'Select a bank',
                linkBank: 'Link Bank',
                loadBanksError: 'Error loading banks',
                linkError: 'Error generating the linking URL',
                noAccountsToSync: 'No accounts to sync',
                syncSuccessAll: 'Successfully synced {{count}} accounts',
                syncErrorAll: 'Failed to sync all {{count}} accounts',
                syncPartial: 'Synced {{successCount}} accounts, {{failureCount}} with errors',
                syncError: 'Error syncing accounts',
                syncAllTitle: 'Sync all linked checking accounts'
            },
            gocardlessCallback: {
                invalidAccountId: 'Invalid account ID',
                noAccounts: 'No bank accounts available for synchronization',
                loadError: 'Error loading bank accounts',
                selectAccountAndBalance: 'Select an account and enter the current balance',
                linkSuccess: 'Bank account linked successfully!',
                syncStartedTitle: 'Sync Started',
                syncStartedDescription: 'Transactions will be imported in the next few minutes.',
                syncErrorTitle: 'Sync Error',
                syncErrorDescription: 'An error occurred while syncing transactions. Please try again later.',
                loadingLinking: 'Linking and importing transactions...',
                loadingAccounts: 'Loading bank accounts...',
                errorTitle: 'Error',
                backToTransactions: 'Back to Transactions',
                selectAccountTitle: 'Select the Account to Sync',
                selectAccountMessage: 'Select a bank account',
                selectAccountDescription: 'Choose which bank account to link and enter the current balance to align transactions correctly.',
                bankUnknown: 'Unknown Bank',
                accountNameLabel: 'Name',
                currentBalanceLabel: 'Current Balance',
                currentBalanceHelp: 'Enter the current balance of the bank account to align transactions correctly',
                currentBalancePlaceholder: 'e.g. 1000.00',
                confirmSelection: 'Confirm Selection'
            },
            dashboard: {
                title: 'Dashboard',
                empty: 'No transactions found for the selected period.',
                netBalance: 'Net Balance',
                totalIncome: 'Total Income',
                totalExpenses: 'Total Expenses',
                vsPeriod: 'vs {{period}}',
                cryptoPortfolio: 'Crypto Portfolio',
                incomeByCategory: 'Income by Category',
                expensesByCategory: 'Expenses by Category',
                monthlyTrend: 'Monthly Trend (Income/Expenses)',
                netBalanceTrend: 'Monthly Net Balance Trend'
            },
            charts: {
                noData: 'No data available'
            },
            transactions: {
                titleAll: 'All Transactions',
                titleAccount: 'Transactions for {{account}}',
                data: 'Date',
                description: 'Description',
                account: 'Account',
                category: 'Category',
                amount: 'Amount',
                type: 'Type',
                typeIn: 'Income',
                typeOut: 'Expense',
                actions: 'Actions',
                newTransaction: 'New Transaction',
                editTransaction: 'Edit Transaction',
                newTransfer: 'New Transfer',
                syncGoCardless: 'Sync GoCardless',
                searchPlaceholder: 'Search by description, account, category',
                filterType: 'Filter by type',
                fromDate: 'From',
                toDate: 'To',
                sortBy: 'Sort by',
                sortOrder: 'Order',
                sortAsc: 'Ascending',
                sortDesc: 'Descending',
                selectAccount: 'Select an account',
                selectCategory: 'Select a category',
                selectType: 'Income or Expense',
                note: 'Notes',
                save: 'Save',
                linkTransfer: 'Link to Transfer',
                linkTransferSave: 'Save Link',
                linkTransferSource: 'Source Transaction',
                linkTransferSelectAccount: 'Select Destination Account',
                linkTransferSelectTransaction: 'Select the transaction to link',
                linkTransferNoCompatible: 'No compatible transaction found within +/-3 days with the same amount and opposite type.',
                linkTransferLoadError: 'Failed to fetch destination transactions.',
                linkTransferSuccess: 'Transactions linked successfully!',
                linkTransferError: 'Error while linking transactions.',
                balanceModalTitle: 'Enter Current Balance',
                balanceCurrent: 'Current Balance',
                balanceCurrentInfo: 'Enter the current balance of the bank account to align transactions after synchronization. If you only want to sync transactions without changing the current balance, leave this field empty.',
                balanceCurrentPlaceholder: 'e.g. 1000.00',
                syncStartedTitle: 'Sync Started',
                syncStartedDescription: 'Transactions will be updated in the background in the next few minutes.',
                syncErrorTitle: 'Sync Error',
                syncErrorDescription: 'An error occurred while syncing transactions. Please try again later.',
                invalidAccountId: 'Invalid account ID',
                currentBalanceLabel: 'Current balance: {{balance}}',
                currentBalanceFallback: 'N/A',
                accountLabelFallback: 'Account'
            },
            crypto: {
                title: 'Crypto Portfolio',
                connectBinance: 'Connect Binance',
                addHolding: 'Add Holding',
                syncBinance: 'Sync Binance',
                syncStarted: 'Binance sync started successfully',
                loadError: 'Failed to load portfolio data.',
                syncError: 'Failed to sync with Binance.',
                holdingDeleted: 'Holding deleted successfully',
                holdingDeleteError: 'Failed to delete holding.'
            },
            portfolio: {
                totalValue: 'Total Portfolio Value',
                yourAssets: 'Your Assets',
                asset: 'Asset',
                amount: 'Amount',
                price: 'Price',
                value: 'Value',
                source: 'Source',
                actions: 'Actions',
                deleteHolding: 'Delete holding',
                deleteHoldingConfirm: 'Are you sure you want to delete this holding?'
            },
            binanceKeys: {
                title: 'Connect Binance Account',
                apiKey: 'API Key',
                apiSecret: 'API Secret',
                apiKeyRequired: 'Please enter your Binance API Key',
                apiSecretRequired: 'Please enter your Binance API Secret',
                saveKeys: 'Save Keys',
                cancel: 'Cancel',
                saveSuccess: 'Binance keys saved successfully',
                saveError: 'Failed to save Binance keys. Please try again.'
            },
            manualHolding: {
                titleAdd: 'Add Manual Holding',
                titleEdit: 'Edit Manual Holding',
                symbol: 'Crypto Symbol',
                symbolRequired: 'Please enter the crypto symbol (e.g., BTC)',
                amount: 'Amount',
                amountRequired: 'Please enter the amount',
                add: 'Add Holding',
                update: 'Update Holding',
                cancel: 'Cancel',
                saveError: 'Failed to save holding. Please try again.',
                addedSuccess: 'Holding added successfully',
                updatedSuccess: 'Holding updated successfully'
            },
            pwa: {
                title: 'Install NexaBudget',
                description: 'Add the app to your Home screen for quick access',
                install: 'Install'
            },
            settings: {
                title: 'Settings',
                appearanceTitle: 'Appearance',
                theme: 'Theme',
                themeLight: 'Light',
                themeDark: 'Dark',
                languageTitle: 'Language',
                language: 'App language',
                languageIt: 'Italian',
                languageEn: 'English',
                serverTitle: 'Server settings',
                serverPlaceholder: 'This section is just a placeholder for now.',
                serverBaseUrl: 'Base URL',
                serverTimeout: 'Timeout (ms)',
                serverTimeoutPlaceholder: 'e.g. 15000'
            }
        }
    }
};

i18n.use(initReactI18next).init({
    resources,
    lng: loadInitialLanguage(),
    fallbackLng: 'it',
    interpolation: {
        escapeValue: false
    }
});

export { i18n };
